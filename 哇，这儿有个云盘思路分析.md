# 哇，这儿有个云盘分析

## 项目分析
### 技术选型
#### 前端
1. 页面展示 
    1. html
    2. css
    3. js
2. 请求
    1. jQuery
    
**偷懒就用用框架嘛，哈哈哈**
#### 后端
1. Web层
    1. servlet ： 前端控制器
    2. html ： 视图
    3. filter ： 过滤器
    4. BeanUtils ： 数据封装
    5. Jackson ： json序列化

2. Service层
    1. Javamain ： java邮件发送工具
    2. redis ： redis内存数据库
    3. jedis ： java的redis客户端

3. dao层
    1. Mysql ： 数据库
    2. Druid ： 连接池
    3. JdbcTemplate ： jdbc的工具


## 项目启动
### 环境配置
1. 数据库配置
    1. 数据库创建，表创建
        * 用户表--- 
            1. 用户id -- uid                    int 主键 ，自增长
            2. 用户名  -- username           varchar  非空
            3. 密码  -- password             varcahr  非空
            4. 姓名  -- uname                 varchar  非空
            5. 性别  -- gender               varchar  非空
            6. 生日  -- birthday             date     非空
            7. 手机号 -- telephone            varchar  非空
            8. 激活状态 -- status             varchar   非空      （Y表示激活，N表示未激活）   
            9. 激活码 -- code                 varchar   非空       （用于邮件激活的，使用java自带的uuid获取存储）
        * 文件类别表
            1. 文件类别id  -- cid        int    自增长，主键约束
            2. 文件类别名  -- cname       varchar   非空
            3. 
        * 用户文件表
            1. 文件名 -- fname
            2. 文件id -- fid
            1. 用户id -- uid            外键
            2. 文件类别id -- cid         外键
            3. 文件上传修改日期 -- fdate     datetime    非空
            4. 文件存储位置 -- faddress     varchar   非空 唯一      
            
2. maven 依赖配置
    1. mysql连接 
    2. druid连接池
    3. email依赖            
    
## 思路及路线
### 前台页面实现
1. 网站首页
2. 用户主页
3. 登录页面
4. 注册页面
5. 文件下载页面
 …… 其他后续完善


### 后台页面实现
#### 用户管理模块
1. 用户注册
    1. 验证码校验
    2. 账户激活
        **邮件工具类的使用**
    
2. 用户登录
    1. 验证码校验
    2. 激活判断
    
3. 用户退出

#### 文件模块
**~~~限速设置**
多线程提速，缓冲区提速
断点续传：使用randomaccessfile类

##### 文件上传
1. 基础文件上传
2. 文件分类存储
3. 文件信息数据库存储

**遇到个大问题，文件上传后文件跑到tomcat的bin目录下，怎么通过url地址访问到上传之后的图片**

##### 文件下载

> ***关于文件上传和下载通过多线程创建***
  思路
  1. 创建两个线程池 - --- 且均采用能够有返回值的Callable接口---返回文件的上传或下载所到字节数（实现断点续传）  
      1. 用于下载的线程池   
      2， 用于上传的线程池
  2. 构建任务集合  ----  前端通过异步请求访问集合，获取下载任务列表和上传任务列表
      1. 上传任务
      2. 下载任务
  3. 有规定线程池的大小，限制同时进行的下载任务和上传任务
      * 问题1：如何进行限制丢给线程池的任务不超过线程的数量（在不通过使用动态创建线程的情况下）    **已解决**
      * 问题2：如何进行暂停相应的任务         
      * 问题3：使用多线程的时候实现Callable接口，返回什么？ 
          1. 老文件和新文件的对象？
          2. 当前进行到的位置
          3. 在线程结束时需要将downloading集合中对应的UserFile 对象移除
              * 如果进行暂停，需要返回下载任务信息 ---- 文件，以及已经保存的字节数 
              * 暂停后，还需要将该 下载任务移动至downloadFiles中
……………………………………………………
-----------------------------------------

**哦豁，以上思路全部错误~~~~ **
    



// TODO 最终要使用过滤器对 没有进行登录的用户进行限制        ---- 完成


文件分类已做 😘


// 2020.11.20 到此基本功能实现了 扩展功能准备开干
1. 会员加速  ---- 完成
    * 使用睡眠的方式进行限速
        * vip下载速度  ---  2mb/s 以下   非vip 下载速度  ----  1mb / s
        * 睡眠时间的确定  由于1mb/s 近似可以看作 1024byte/ms  所以对非会员 每读取 1024 字节则睡 1ms 
        
2. 断点续传  ------  完成
    * 怎么在前台显示正在进行的任务，从而进行暂停 和 继续
    * 基于之前文件上传下载使用的RandomAccessFile 类
    
3. 文件预览        ---- 完成 
    * 使用了开源项目kkFileView完成
    
    
    
后续优化：
1. 需要一个 register_ok.html              ----- 完成
2. 将register_ok.html页面重用到激活成功页面   ----  完成
3. vip界面，以及vip开通按钮                 ---- 完成
4. 用户文件界面的美化                      ---- 完成
5. 将文件上传功能与用户文件页面合并 
6. 将任务列表界面链接            --- -- 完成

